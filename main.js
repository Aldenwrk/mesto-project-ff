(()=>{"use strict";var t="https://nomoreparties.co/v1/wff-cohort-13",e="b3000371-daae-4193-a69c-238bf82131cf",n="application/json",o=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))};function c(t,e,n,o,c,r){var a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__delete-button"),i=a.querySelector(".card__like-button"),l=a.querySelector(".card__like-button_counter"),s=a.querySelector(".card__image"),d=t._id;return a.querySelector(".card__title").textContent=t.name,s.src=t.link,s.alt=t.name,l.textContent=t.likes.length,1==r(t,c)&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(){return n(i,t,c,d,l)})),s.addEventListener("click",(function(){return o(event)})),c==t.owner._id?u.addEventListener("click",(function(){return e(a,d)})):u.style.display="none",a}function r(n,c,r,a,u){n.classList.contains("card__like-button_is-active")?function(n){return fetch("".concat(t,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))}(a).then((function(t){u.textContent=t.likes.length})).then((function(t){n.classList.remove("card__like-button_is-active")})).catch((function(t){console.log(t)})):function(n){return fetch("".concat(t,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))}(a).then((function(t){u.textContent=t.likes.length})).then((function(t){n.classList.add("card__like-button_is-active")})).catch((function(t){console.log(t)}))}var a=function(t,e){return t.likes.some((function(t){return t._id==e}))},u=function(n,c){(function(n){return fetch("".concat(t,"/cards/").concat(n),{method:"DELETE",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)}))})(c).then((function(t){n.remove()})).catch((function(t){console.log(t)}))};function i(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",d)}function l(t){document.removeEventListener("keydown",d),t.classList.remove("popup_is-opened")}function s(t){var e=t.currentTarget;t.target===e&&l(e)}function d(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&l(e)}}var f,p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input-error",errorClass:"span__input-error_active"},_=function(t){return t.some((function(t){return!t.validity.valid}))};function m(t,e,n){_(t)?e.classList.add(n.inactiveButtonClass):e.classList.remove(n.inactiveButtonClass)}function v(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function h(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?v(t,e,p):function(t,e,n,o){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(t,e,e.validationMessage,p)}function y(t,e){Array.from(t.querySelectorAll(".".concat(e.inputErrorClass))).forEach((function(n){v(t,n,e)}));var n=t.querySelector(e.submitButtonSelector);m(Array.from(t.querySelectorAll(e.inputSelector)),n,e)}var S=document.querySelector(".places__list");function q(t){var e,n;e=t.target.src,n=t.target.alt,i(C),L.src=e,L.alt=n,E.textContent=n}var C=document.querySelector(".popup_type_image"),E=document.querySelector(".popup__caption"),L=document.querySelector(".popup__image");document.querySelectorAll(".popup").forEach((function(t){t.classList.add("popup_is-animated")}));var k=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__edit-button"),g=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card");document.querySelectorAll(".popup__close").forEach((function(t){t.addEventListener("click",(function(){l(t.closest(".popup_is-opened"))}))})),k.addEventListener("click",(function(){P.reset(),y(P,p),i(x)}));var A=document.querySelector(".profile__title"),T=document.querySelector(".profile__description");b.addEventListener("click",(function(){z.reset(),y(z,p),i(g),w.value=A.textContent,B.value=T.textContent})),x.addEventListener("click",s),g.addEventListener("click",s),C.addEventListener("click",s);var z=document.forms["edit-profile"],w=z.elements.name,B=z.elements.description,D=z.querySelector(".button");z.addEventListener("submit",(function(c){c.preventDefault(),D.textContent="Сохранение...",function(c,r){return fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"".concat(n)},body:JSON.stringify({name:c.value,about:r.value})}).then((function(t){return o(t)}))}(w,B).then((function(t){A.textContent=t.name,T.textContent=t.about})).then((function(t){z.reset(),l(g)})).catch((function(t){console.log(t)})).finally((function(){D.textContent="Сохранить"}))}));var P=document.forms["new-place"],N=P.querySelector(".button");P.addEventListener("submit",(function(i){i.preventDefault();var s=P.querySelector(".popup__input_type_card-name").value,d=P.querySelector(".popup__input_type_url").value;N.textContent="Сохранение...",function(c,r){return fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:"".concat(e),"Content-Type":"".concat(n)},body:JSON.stringify({name:c,link:r})}).then((function(t){return o(t)}))}(s,d).then((function(t){S.prepend(c(t,u,r,q,f,a))})).then((function(t){P.reset(),l(x)})).catch((function(t){console.log(t)})).finally((function(){N.textContent="Сохранить"}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()}));var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);m(n,o,t),n.forEach((function(c){c.addEventListener("input",(function(){h(e,c),m(n,o,t)}))}))}))}(p),Promise.all([fetch("".concat(t,"/users/me"),{headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})),fetch("".concat(t,"/cards"),{headers:{authorization:"".concat(e)}}).then((function(t){return o(t)}))]).then((function(t){return A.textContent=t[0].name,T.textContent=t[0].about,O.style.backgroundImage="url('"+t[0].avatar+"')",f=t[0]._id,t})).then((function(t){t[1].forEach((function(t){S.append(c(t,u,r,q,f,a))}))})).catch((function(t){console.log(t)}));var O=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_avatar_edit"),J=j.querySelector(".popup__form"),M=J.querySelector(".button");O.addEventListener("click",(function(){J.reset(),y(J,p),i(j)})),j.addEventListener("click",s),J.addEventListener("submit",(function(c){c.preventDefault();var r=J.elements.avatarLink.value;M.textContent="Сохранение...",function(c){return fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"".concat(n)},body:JSON.stringify({avatar:c})}).then((function(t){return o(t)}))}(r).then((function(t){O.style.backgroundImage="url('"+t.avatar+"')"})).then((function(t){z.reset(),l(j)})).catch((function(t){console.log(t)})).finally((function(){M.textContent="Сохранить"}))}))})();
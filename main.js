(()=>{"use strict";var t="https://nomoreparties.co/v1/wff-cohort-13",e="b3000371-daae-4193-a69c-238bf82131cf",n="application/json",o=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))};function r(t,e,n,o,r,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__delete-button"),a=u.querySelector(".card__like-button"),l=u.querySelector(".card__like-button_counter"),s=u.querySelector(".card__image"),d=t._id;return u.querySelector(".card__title").textContent=t.name,s.src=t.link,s.alt=t.name,l.textContent=t.likes.length,1==c(t,r)&&a.classList.add("card__like-button_is-active"),a.addEventListener("click",(function(){return n(a,t,r,d,l)})),s.addEventListener("click",(function(){return o(event)})),r==t.owner._id?i.addEventListener("click",(function(){return e(u,d)})):i.style.display="none",u}function c(n,r,c,u,i){n.classList.contains("card__like-button_is-active")?(function(n){return fetch("".concat(t,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))}(u).then((function(t){i.textContent=t.likes.length})).catch((function(t){console.log(t)})),n.classList.remove("card__like-button_is-active")):(function(n){return fetch("".concat(t,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))}(u).then((function(t){i.textContent=t.likes.length})).catch((function(t){console.log(t)})),n.classList.add("card__like-button_is-active"))}var u=function(t,e){return t.likes.some((function(t){return t._id==e}))},i=function(n,r){(function(n){return fetch("".concat(t,"/cards/").concat(n),{method:"DELETE",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)}))})(r).then((function(t){n.remove()}))};function a(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",d)}function l(t){document.removeEventListener("keydown",d),t.classList.remove("popup_is-opened"),t!==document.querySelector(".popup_type_image")&&t.querySelector(".popup__form").reset()}function s(t){var e=t.currentTarget;t.target===e&&l(e)}function d(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&l(e)}}var p,f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input-error",errorClass:"span__input-error_active"},_=function(t){return t.some((function(t){return!t.validity.valid}))};function m(t,e,n){_(t)?e.classList.add(n.inactiveButtonClass):e.classList.remove(n.inactiveButtonClass)}function y(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function v(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?y(t,e,f):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,f)}function h(t,e){Array.from(t.querySelectorAll(".".concat(e.inputErrorClass))).forEach((function(n){y(t,n,e)}));var n=t.querySelector(e.submitButtonSelector);m(Array.from(t.querySelectorAll(e.inputSelector)),n,e)}var S=document.querySelector(".places__list");function q(t){var e,n,o,r;e=t.target.src,n=t.target.alt,o=document.querySelector(".popup__caption"),r=document.querySelector(".popup__image"),a(C),r.src=e,r.alt=n,o.textContent=n}var C=document.querySelector(".popup_type_image");document.querySelectorAll(".popup").forEach((function(t){t.classList.add("popup_is-animated")}));var E=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_type_new-card");document.querySelectorAll(".popup__close").forEach((function(t){t.addEventListener("click",(function(){l(t.closest(".popup_is-opened"))}))})),E.addEventListener("click",(function(){a(k),h(k.querySelector(".popup__form"),f)})),L.addEventListener("click",(function(){a(b),h(b.querySelector(".popup__form"),f);var t=document.querySelector(".profile__title");x.value=t.textContent;var e=document.querySelector(".profile__description");A.value=e.textContent})),k.addEventListener("click",s),b.addEventListener("click",s),C.addEventListener("click",s);var g=document.forms["edit-profile"],x=g.elements.name,A=g.elements.description,T=document.querySelector(".profile__title"),z=document.querySelector(".profile__description"),w=g.querySelector(".button");g.addEventListener("submit",(function(r){r.preventDefault(),w.textContent="Сохранение...",fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"".concat(n)},body:JSON.stringify({name:nameInput.value,about:jobInput.value})}).then((function(t){return o(t)})).then((function(t){T.textContent=t.name,z.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){w.textContent="Сохранить",g.reset(),l(b)}))}));var B=document.forms["new-place"],D=B.querySelector(".button");B.addEventListener("submit",(function(a){a.preventDefault();var s=B.querySelector(".popup__input_type_card-name").value,d=B.querySelector(".popup__input_type_url").value;D.textContent="Сохранение...",function(r,c){return fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:"".concat(e),"Content-Type":"".concat(n)},body:JSON.stringify({name:r,link:c})}).then((function(t){return o(t)}))}(s,d).then((function(t){S.prepend(r(t,i,c,q,p,u))})).catch((function(t){console.log(t)})).finally((function(){D.textContent="Сохранить",B.reset(),l(k)}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()}));var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);m(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){v(e,r),m(n,o,t)}))}))}))}(f),Promise.all([fetch("".concat(t,"/users/me"),{headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})),fetch("".concat(t,"/cards"),{headers:{authorization:"".concat(e)}}).then((function(t){return o(t)}))]).then((function(t){return document.querySelector(".profile__title").textContent=t[0].name,document.querySelector(".profile__description").textContent=t[0].about,document.querySelector(".profile__image").style.backgroundImage="url('"+t[0].avatar+"')",p=t[0]._id,t})).then((function(t){t[1].forEach((function(t){S.append(r(t,i,c,q,p,u))}))})).catch((function(t){console.log(t)}));var P=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_avatar_edit"),I=j.querySelector(".popup__form"),N=I.querySelector(".button");P.addEventListener("click",(function(){a(j),h(I,f)})),j.addEventListener("click",s),I.addEventListener("submit",(function(r){r.preventDefault();var c=I.elements.avatarLink.value;N.textContent="Сохранение...",function(r){return fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"".concat(n)},body:JSON.stringify({avatar:r})}).then((function(t){return o(t)}))}(c).then((function(t){document.querySelector(".profile__image").style.backgroundImage="url('"+t.avatar+"')"})).catch((function(t){console.log(t)})).finally((function(){N.textContent="Сохранить",g.reset(),l(j)}))}))})();
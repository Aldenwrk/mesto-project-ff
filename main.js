(()=>{"use strict";var t="https://nomoreparties.co/v1/wff-cohort-13",e="b3000371-daae-4193-a69c-238bf82131cf",n="application/json",o=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},r=function(){return fetch("".concat(t,"/users/me"),{headers:{authorization:"".concat(e)}}).then((function(t){return o(t)}))},c=function(){return fetch("".concat(t,"/cards"),{headers:{authorization:"".concat(e)}}).then((function(t){return o(t)}))};function u(t,e,n,o,r,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__delete-button"),a=u.querySelector(".card__like-button"),l=u.querySelector(".card__like-button_counter"),s=u.querySelector(".card__image"),d=t._id;return u.querySelector(".card__title").textContent=t.name,s.src=t.link,s.alt=t.name,l.textContent=t.likes.length,1==c(t,r)&&a.classList.add("card__like-button_is-active"),a.addEventListener("click",(function(){return n(a,t,r,d,l)})),s.addEventListener("click",(function(){return o(event)})),r==t.owner._id?i.addEventListener("click",(function(){return e(u,d)})):i.style.display="none",u}function i(n,r,c,u,i){n.classList.contains("card__like-button_is-active")?(function(n){return fetch("".concat(t,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))}(u).then((function(t){i.textContent=t.likes.length})).catch((function(t){console.log(t)})),n.classList.remove("card__like-button_is-active")):(function(n){return fetch("".concat(t,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){console.log(t)}))}(u).then((function(t){i.textContent=t.likes.length})).catch((function(t){console.log(t)})),n.classList.add("card__like-button_is-active"))}var a=function(t,e){return t.likes.some((function(t){return t._id==e}))},l=function(n,r){(function(n){return fetch("".concat(t,"/cards/").concat(n),{method:"DELETE",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)}))})(r).then((function(t){n.remove()}))};function s(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",f)}function d(t){document.removeEventListener("keydown",f),t.classList.remove("popup_is-opened"),t!==document.querySelector(".popup_type_image")&&t.querySelector(".popup__form").reset()}function p(t){var e=t.currentTarget;t.target===e&&d(e)}function f(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&d(e)}}var _,m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input-error",errorClass:"span__input-error_active"},y=function(t){return t.some((function(t){return!t.validity.valid}))};function v(t,e,n){y(t)?e.classList.add(n.inactiveButtonClass):e.classList.remove(n.inactiveButtonClass)}function h(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function S(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?h(t,e,m):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,m)}function q(t,e){Array.from(t.querySelectorAll(".".concat(e.inputErrorClass))).forEach((function(n){h(t,n,e)}));var n=t.querySelector(e.submitButtonSelector);v(Array.from(t.querySelectorAll(e.inputSelector)),n,e)}var C=document.querySelector(".places__list");function E(t){var e,n,o,r;e=t.target.src,n=t.target.alt,o=document.querySelector(".popup__caption"),r=document.querySelector(".popup__image"),s(L),r.src=e,r.alt=n,o.textContent=n}var L=document.querySelector(".popup_type_image");document.querySelectorAll(".popup").forEach((function(t){t.classList.add("popup_is-animated")}));var b=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__edit-button"),g=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card");document.querySelectorAll(".popup__close").forEach((function(t){t.addEventListener("click",(function(){d(t.closest(".popup_is-opened"))}))})),b.addEventListener("click",(function(){s(x),q(x.querySelector(".popup__form"),m)})),k.addEventListener("click",(function(){s(g),q(g.querySelector(".popup__form"),m);var t=document.querySelector(".profile__title");T.value=t.textContent;var e=document.querySelector(".profile__description");z.value=e.textContent})),x.addEventListener("click",p),g.addEventListener("click",p),L.addEventListener("click",p);var A=document.forms["edit-profile"],T=A.elements.name,z=A.elements.description,w=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),D=A.querySelector(".button");A.addEventListener("submit",(function(r){r.preventDefault(),D.textContent="Сохранение...",fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"".concat(n)},body:JSON.stringify({name:nameInput.value,about:jobInput.value})}).then((function(t){return o(t)})).then((function(t){w.textContent=t.name,B.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){D.textContent="Сохранить",A.reset(),d(g)}))}));var P=document.forms["new-place"],j=P.querySelector(".button");P.addEventListener("submit",(function(r){r.preventDefault();var c=P.querySelector(".popup__input_type_card-name").value,s=P.querySelector(".popup__input_type_url").value;j.textContent="Сохранение...",function(r,c){return fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:"".concat(e),"Content-Type":"".concat(n)},body:JSON.stringify({name:r,link:c})}).then((function(t){return o(t)}))}(c,s).then((function(t){C.prepend(u(t,l,i,E,_,a))})).catch((function(t){console.log(t)})).finally((function(){j.textContent="Сохранить",P.reset(),d(x)}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()}));var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);v(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){S(e,r),v(n,o,t)}))}))}))}(m),Promise.all([r(),c()]),r().then((function(t){return document.querySelector(".profile__title").textContent=t.name,document.querySelector(".profile__description").textContent=t.about,document.querySelector(".profile__image").style.backgroundImage="url('"+t.avatar+"')",_=t._id,t})),c().then((function(t){t.forEach((function(t){C.append(u(t,l,i,E,_,a))}))})).catch((function(t){console.log(t)}));var I=document.querySelector(".profile__image"),N=document.querySelector(".popup_type_avatar_edit"),O=N.querySelector(".popup__form"),J=O.querySelector(".button");I.addEventListener("click",(function(){s(N),q(O,m)})),N.addEventListener("click",p),O.addEventListener("submit",(function(r){r.preventDefault();var c=O.elements.avatarLink.value;J.textContent="Сохранение...",function(r){return fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"".concat(n)},body:JSON.stringify({avatar:r})}).then((function(t){return o(t)}))}(c).then((function(t){document.querySelector(".profile__image").style.backgroundImage="url('"+t.avatar+"')"})).catch((function(t){console.log(t)})).finally((function(){J.textContent="Сохранить",A.reset(),d(N)}))}))})();
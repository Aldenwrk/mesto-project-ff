(()=>{"use strict";var e,t="https://nomoreparties.co/v1/wff-cohort-13",n="b3000371-daae-4193-a69c-238bf82131cf",o="application/json",r=function(e,o){return fetch("".concat(t,"/cards/").concat(o),{method:"DELETE",headers:{authorization:"".concat(n)}}).then((function(t){if(!t.ok)return Promise.reject("Ошибка: ".concat(t.status));e.remove()}))},c=function(){return fetch("".concat(t,"/cards"),{headers:{authorization:"".concat(n)}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function u(e,t,n,o,r,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__delete-button"),i=u.querySelector(".card__like-button"),s=u.querySelector(".card__like-button_counter"),l=u.querySelector(".card__image"),p=e._id;return u.querySelector(".card__title").textContent=e.name,l.src=e.link,l.alt=e.name,s.textContent=e.likes.length,1==c(e,r)&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(){return n(i,e,r,p,s)})),l.addEventListener("click",(function(){return o(event)})),r==e.owner._id?a.addEventListener("click",(function(){return t(u,p)})):a.style.display="none",u}function a(e,o,r,c,u){e.classList.contains("card__like-button_is-active")?(function(e){return fetch("".concat(t,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:"".concat(n)}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(c).then((function(e){u.textContent=e.likes.length})).catch((function(e){console.log(e)})),e.classList.remove("card__like-button_is-active")):(function(e){return fetch("".concat(t,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:"".concat(n)}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(c).then((function(e){u.textContent=e.likes.length})).catch((function(e){console.log(e)})),e.classList.add("card__like-button_is-active"))}var i=function(e,t){return e.likes.some((function(e){return e._id==t}))};function s(e){if(e.classList.add("popup_is-opened"),document.addEventListener("keydown",d),e.classList.contains("popup_type_edit")){var t=document.forms["edit-profile"],n=t.elements.name,o=t.elements.description,r=document.querySelector(".profile__title");n.value=r.textContent;var c=document.querySelector(".profile__description");o.value=c.textContent}}function l(e){document.removeEventListener("keydown",d),e.classList.remove("popup_is-opened"),e!==document.querySelector(".popup_type_image")&&e.querySelector(".popup__form").reset()}function p(e){var t=e.currentTarget;e.target===t&&l(t)}function d(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&l(t)}}var f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input-error",errorClass:"span__input-error_active"},m=function(e){return e.some((function(e){return!e.validity.valid}))};function _(e,t,n){m(e)?t.classList.add(n.inactiveButtonClass):t.classList.remove(n.inactiveButtonClass)}function y(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function v(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?y(e,t,f):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,f)}function S(e,t){Array.from(e.querySelectorAll(".popup__input-error")).forEach((function(n){y(e,n,t)}));var n=e.querySelector(t.submitButtonSelector);_(Array.from(e.querySelectorAll(t.inputSelector)),n,t)}var h=document.querySelector(".places__list");function q(e){var t,n,o,r;t=e.target.src,n=e.target.alt,o=document.querySelector(".popup__caption"),r=document.querySelector(".popup__image"),s(k),r.src=t,r.alt=n,o.textContent=n}var k=document.querySelector(".popup_type_image");document.querySelectorAll(".popup").forEach((function(e){e.classList.add("popup_is-animated")}));var C=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_new-card");document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){l(e.closest(".popup_is-opened"))}))})),C.addEventListener("click",(function(){s(E),S(E.querySelector(".popup__form"),f)})),L.addEventListener("click",(function(){s(b),S(b.querySelector(".popup__form"),f)})),E.addEventListener("click",p),b.addEventListener("click",p),k.addEventListener("click",p);var g=document.forms["edit-profile"];g.elements.name,g.elements.description,g.addEventListener("submit",(function(e){e.preventDefault();var r=document.querySelector(".profile__title"),c=document.querySelector(".profile__description");g.querySelector(".button").textContent="Сохранение...",function(){var e=document.forms["edit-profile"],r=e.elements.name,c=e.elements.description;return fetch("".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(n),"Content-Type":"".concat(o)},body:JSON.stringify({name:r.value,about:c.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}().then((function(e){r.textContent=e.name,c.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){g.querySelector(".button").textContent="Сохранить"})),g.reset();var u=document.querySelector(".popup_is-opened");u&&l(u)}));var x=document.forms["new-place"];x.addEventListener("submit",(function(c){c.preventDefault(),x.querySelector(".button").textContent="Сохранение...",function(){var e=document.forms["new-place"],r=e.querySelector(".popup__input_type_card-name").value,c=e.querySelector(".popup__input_type_url").value;return fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:"".concat(n),"Content-Type":"".concat(o)},body:JSON.stringify({name:r,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}().then((function(t){h.prepend(u(t,r,a,q,e,i))})).catch((function(e){console.log(e)})).finally((function(){x.querySelector(".button").textContent="Сохранить"})),x.reset();var s=document.querySelector(".popup_is-opened");s&&l(s)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()}));var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);_(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){v(t,r),_(n,o,e)}))}))}))}(f),Promise.all([fetch("".concat(t,"/users/me"),{headers:{authorization:"".concat(n)}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){return document.querySelector(".profile__title").textContent=t.name,document.querySelector(".profile__description").textContent=t.about,document.querySelector(".profile__image").style.backgroundImage="url('"+t.avatar+"')",e=t._id,t})),c()]),c().then((function(t){t.forEach((function(t){h.append(u(t,r,a,q,e,i))}))})).catch((function(e){console.log(e)}));var j=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_avatar_edit"),A=P.querySelector(".popup__form");j.addEventListener("click",(function(){s(P),S(A,f)})),P.addEventListener("click",p),A.addEventListener("submit",(function(e){var r;e.preventDefault(),A.querySelector(".button").textContent="Сохранение...",(r=document.querySelector(".popup_type_avatar_edit").querySelector(".popup__form").elements.avatarLink.value,fetch("".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(n),"Content-Type":"".concat(o)},body:JSON.stringify({avatar:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){document.querySelector(".profile__image").style.backgroundImage="url('"+e.avatar+"')"})).catch((function(e){console.log(e)})).finally((function(){A.querySelector(".button").textContent="Сохранить"})),g.reset();var c=document.querySelector(".popup_is-opened");c&&l(c)}))})();